<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tomkins.live</title>
  <meta name="description" content="Tomkins.live — minimal, cinematic splash page." />
  <meta property="og:title" content="Tomkins.live" />
  <meta property="og:description" content="Minimal, cinematic splash page." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0b0b0c" />
  <style>
    /* ---- CSS Reset (trimmed) ---- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#0a0a0a; color:#e5e7eb; overflow:hidden; }
    a { color: inherit; text-decoration: none; }
    /* ---- Palette ---- */
    :root {
      --bg:#0a0a0a;             /* black */
      --panel:#0f0f10;          /* deep grey */
      --muted:#9ca3af;          /* grey-400 */
      --line:#2a2a2b;           /* border */
      --white:#f3f4f6;
      --glow:#bfbfbf;           /* steel */
      --accent:#9f9f9f;         /* subtle accent */
    }

    /* ---- Stage ---- */
    .stage {
      position: relative; inset:0; width:100vw; height:100vh; 
      background: radial-gradient(1200px 800px at 70% 20%, #1a1a1b 0%, #0d0d0e 40%, var(--bg) 85%);
      display:grid; place-items:center;
      isolation:isolate;
    }

    /* Subtle vignette */
    .vignette { position:absolute; inset:-10vmin; pointer-events:none; z-index:0;
      background: radial-gradient(80vmax 80vmax at 50% 60%, transparent 55%, rgba(0,0,0,.55) 100%);
      mix-blend-mode:multiply; }

    /* Animated grain */
    .grain { position:absolute; inset:-50%; opacity:.08; pointer-events:none; z-index:0; filter:contrast(140%) brightness(140%);
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="300" height="300" filter="url(%23n)" opacity=".7"/></svg>');
      animation: grain 7s steps(10) infinite; }
    @keyframes grain { to { transform: translate3d(-10%, -10%, 0) } }

    /* Parallax orbs */
    .orb { position:absolute; width:60vmax; height:60vmax; border-radius:50%; filter: blur(60px) saturate(120%);
      background: radial-gradient(circle at 30% 30%, #2b2b2c 0%, #171718 35%, rgba(10,10,10,.8) 60%, transparent 70%);
      opacity:.35; translate:0 0; will-change: transform; transition: transform .3s ease-out; }
    .orb--2 { width:50vmax; height:50vmax; right:-15vmax; bottom:-10vmax; opacity:.25; background: radial-gradient(circle at 60% 60%, #1f1f20 0%, #111112 40%, transparent 70%); }

    /* Center card */
    .card { position:relative; z-index:2; width:min(92vw, 1000px); padding: clamp(24px, 7vmin, 56px); border-radius: 28px; 
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 20px 60px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.04);
      backdrop-filter: blur(18px) saturate(120%);
    }

    .badge { display:inline-flex; align-items:center; gap:.6ch; padding:.5rem .9rem; border:1px solid var(--line); border-radius:999px; color:var(--muted); font-size:.85rem; letter-spacing:.04em; text-transform:uppercase; background:rgba(0,0,0,.3); }
    .dot { display:inline-block; width:.5rem; height:.5rem; border-radius:50%; background:linear-gradient(180deg, #34d399, #059669); box-shadow:0 0 12px rgba(16,185,129,.55); }

    .title { font-weight:800; line-height:1; margin: .6em 0 .25em; letter-spacing:-.02em; 
      font-size: clamp(38px, 9vw, 96px); background: linear-gradient(180deg, #e5e7eb, #a3a3a3 60%, #7c7c7c); -webkit-background-clip:text; background-clip:text; color:transparent; }

    .sub { color:#b3b3b3; font-size: clamp(14px, 2.5vw, 20px); max-width: 68ch; line-height:1.6; }

    /* Divider */
    .hr { height:1px; margin: 2rem 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent); border:0; }

    /* Footer row */
    .row { display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:1rem; }
    .pill { display:inline-flex; align-items:center; gap:.7ch; border:1px solid rgba(255,255,255,.12); padding:.7rem 1rem; border-radius:999px; color:#d1d5db; background:rgba(255,255,255,.02); }
    .pill svg { opacity:.8 }

    /* Pulsing status dot */
    .status-dot { display:inline-block; width:.5rem; height:.5rem; border-radius:50%; background:linear-gradient(180deg, #34d399, #059669); box-shadow:0 0 0 0 rgba(16,185,129,.6); animation: statusPulse 1.8s ease-in-out infinite; }
    @keyframes statusPulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16,185,129,.6) }
      70% { transform: scale(1.25); box-shadow: 0 0 0 10px rgba(16,185,129,0) }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16,185,129,0) }
    }

    /* Circular emblem */
    .crest {
      --s: 160px;
      width: var(--s); height: var(--s); border-radius:50%; position:relative; flex:none;
      display:grid; place-items:center; overflow: hidden; isolation:isolate;
      background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #0f0f10 60%);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 20px 60px rgba(0,0,0,.5);
    }
    .crest::before { content:""; position:absolute; inset:-2px; border-radius:50%; padding:2px; background: conic-gradient(from 0deg, rgba(255,255,255,.25), rgba(255,255,255,.02) 30%, rgba(255,255,255,.25) 60%, rgba(255,255,255,.02)); -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; animation: spin 18s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg) } }

    .crest svg { width: 62%; opacity:.95; filter: drop-shadow(0 6px 14px rgba(0,0,0,.65)); }

    /* Moving monospace strip */
    .ticker { position: absolute; left:0; right:0; bottom: 8vh; z-index:1; pointer-events:none; overflow:hidden; mask-image: linear-gradient(90deg, transparent, #000 10%, #000 90%, transparent);
      opacity:.45; }
    .ticker__track { display:flex; gap:4rem; white-space:nowrap; will-change: transform; animation: marquee 26s linear infinite; }
    @keyframes marquee { to { transform: translateX(-50%) } }
    .ticker span { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; letter-spacing:.08em; font-size: clamp(10px, 1.6vw, 14px); color:#9ca3af; text-transform: uppercase }

    /* Space Invaders mini-game */
    .game { margin-top: 1.25rem; display: grid; gap: .75rem; }
    .game__toolbar { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap }
    .btn { appearance:none; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.04); color:#e5e7eb; padding:.5rem .9rem; border-radius:999px; font-size:.9rem; cursor:pointer; }
    .btn[aria-pressed="true"] { background:rgba(16,185,129,.12); border-color: rgba(16,185,129,.35) }
    .game__help { color:#9ca3af; font-size:.8rem }
    canvas#si { width:100%; height:auto; border-radius:12px; background: radial-gradient(120% 120% at 50% 20%, #0f0f10 0%, #0c0c0d 60%, #0a0a0a 100%); image-rendering: pixelated; box-shadow: inset 0 0 0 1px rgba(255,255,255,.06); }

    /* Cursor ring */
    .ring { position: fixed; z-index: 3; left:0; top:0; width:36px; height:36px; margin:-18px 0 0 -18px; border-radius: 999px; border:1px solid rgba(255,255,255,.25); pointer-events:none; mix-blend-mode: difference; opacity:.65; transform: translate3d(-100px,-100px,0); transition: width .2s ease, height .2s ease, opacity .2s ease; }
    .ring--hide { opacity:0 }

    /* Responsive */
    @media (max-width: 640px) { .row { gap:1.25rem } .crest { --s: 120px } .ticker { bottom: 4vh } }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) { .ticker__track { animation: none } .crest::before { animation: none } .grain { animation:none } }
  </style>
</head>
<body>
  <div class="stage" aria-label="Tomkins.live splash screen">
    <div class="vignette"></div>
    <div class="grain"></div>
    <div class="orb" id="orb1"></div>
    <div class="orb orb--2" id="orb2"></div>

    <main class="card" role="main">
      <span class="badge"><span class="dot"></span> Tomkins.live</span>
      <h1 class="title">Space Invaders</h1>
      <div class="game">
        <div class="game__toolbar">
          <button id="btnStart" class="btn" type="button">Start</button>
          <button id="btnPause" class="btn" type="button" aria-pressed="false">Pause</button>
          <span class="game__help">Move: ← →  •  Fire: Space  •  Pause: P</span>
        </div>
        <canvas id="si" width="720" height="480" aria-label="Space Invaders game area"></canvas>
      </div>

      <hr class="hr" />

      <div class="row">
        <div class="pill" title="Primary contact">
          <!-- envelope icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M4 6h16a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1Z" stroke="#c4c4c4" stroke-width="1.2"/><path d="m3.5 7.5 7.7 5.3a2 2 0 0 0 2.3 0l7.7-5.3" stroke="#c4c4c4" stroke-width="1.2"/></svg>
          <a href="mailto:hello@tomkins.live" aria-label="Email hello at tomkins dot live">hello@tomkins.live</a>
        </div>
        
        <div class="pill" title="Status">
          <!-- activity icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 12h4l2 6 4-12 2 6h6" stroke="#c4c4c4" stroke-width="1.2" stroke-linecap="round"/></svg>
          <span class="status-dot" aria-hidden="true"></span>
          <span>Online</span>
        </div>
      </div>
    </main>

    <div class="ticker" aria-hidden="true">
      <div class="ticker__track">
        <span>NL West: LAD —, SD —, ARI —, SF —, COL —</span>
      </div>
    </div>
  </div>

  <!-- Cursor ring & parallax -->
  <div class="ring ring--hide" id="ring"></div>
  <!-- Inline fallback for NL West standings (same-origin, no CORS) -->
  <script type="application/json" id="nlw-local">{"teams":[{"abbr":"LAD","wins":72,"losses":54},{"abbr":"SD","wins":70,"losses":56},{"abbr":"ARI","wins":62,"losses":66},{"abbr":"SF","wins":61,"losses":65},{"abbr":"COL","wins":36,"losses":90}]}</script>
  <script>
    const ring = document.getElementById('ring');
    const orb1 = document.getElementById('orb1');
    const orb2 = document.getElementById('orb2');
    let raf; let mouse = {x: innerWidth/2, y: innerHeight/2};

    const move = (e) => { mouse.x = e.clientX; mouse.y = e.clientY; ring.classList.remove('ring--hide'); }
    const leave = () => ring.classList.add('ring--hide');

    const tick = () => {
      const tx = mouse.x; const ty = mouse.y;
      ring.style.transform = `translate3d(${tx}px, ${ty}px, 0)`;
      // Parallax the orbs
      const cx = (tx / innerWidth - 0.5);
      const cy = (ty / innerHeight - 0.5);
      orb1.style.transform = `translate3d(${cx * 40}px, ${cy * 40}px, 0)`;
      orb2.style.transform = `translate3d(${cx * -20}px, ${cy * -10}px, 0)`;
      raf = requestAnimationFrame(tick);
    };

    window.addEventListener('mousemove', move);
    window.addEventListener('mouseleave', leave);
    window.addEventListener('mouseenter', move);
    tick();
  </script>

  <script>
    // Space Invaders game logic
    (() => {
      const canvas = document.getElementById('si');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const W = canvas.width, H = canvas.height;

      let animationId = 0;
      let running = false;
      let paused = false;

      const player = { x: W/2 - 18, y: H - 56, w: 36, h: 14, speed: 4 };
      const bullets = [];
      const enemies = [];
      const enemyCols = 10, enemyRows = 4;
      const enemyGapX = 36, enemyGapY = 24;
      let enemyDir = 1; // 1 -> right, -1 -> left
      let enemySpeed = 1.0;
      let stepDownFrames = 0;
      let score = 0;
      let lastShot = 0;
      const shotCooldown = 220;

      const keys = { left:false, right:false, shoot:false };
      addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') keys.left = true;
        if (e.key === 'ArrowRight') keys.right = true;
        if (e.code === 'Space') keys.shoot = true;
        if (e.key.toLowerCase() === 'p') togglePause();
      });
      addEventListener('keyup', (e) => {
        if (e.key === 'ArrowLeft') keys.left = false;
        if (e.key === 'ArrowRight') keys.right = false;
        if (e.code === 'Space') keys.shoot = false;
      });

      const btnStart = document.getElementById('btnStart');
      const btnPause = document.getElementById('btnPause');
      btnStart && btnStart.addEventListener('click', start);
      btnPause && btnPause.addEventListener('click', togglePause);

      function buildEnemies() {
        enemies.length = 0;
        const totalWidth = (enemyCols - 1) * enemyGapX;
        const startX = (W - totalWidth) / 2;
        const startY = 80;
        for (let r = 0; r < enemyRows; r++) {
          for (let c = 0; c < enemyCols; c++) {
            enemies.push({ x: startX + c * enemyGapX, y: startY + r * enemyGapY, w: 16, h: 12, alive: true });
          }
        }
      }

      function reset() {
        bullets.length = 0;
        score = 0;
        player.x = W/2 - player.w/2;
        enemyDir = 1;
        enemySpeed = 1.0;
        stepDownFrames = 0;
        buildEnemies();
      }

      function start() {
        reset();
        running = true;
        paused = false;
        if (btnPause) btnPause.setAttribute('aria-pressed', 'false');
        loop();
      }

      function togglePause() {
        if (!running) return;
        paused = !paused;
        if (btnPause) btnPause.setAttribute('aria-pressed', paused ? 'true' : 'false');
        if (!paused) loop();
      }

      function loop() {
        if (!running || paused) return;
        update();
        draw();
        animationId = requestAnimationFrame(loop);
      }

      function update() {
        // Move player
        if (keys.left) player.x -= player.speed;
        if (keys.right) player.x += player.speed;
        player.x = Math.max(12, Math.min(W - player.w - 12, player.x));

        // Shoot
        const now = performance.now();
        if (keys.shoot && now - lastShot > shotCooldown) {
          bullets.push({ x: player.x + player.w/2 - 2, y: player.y - 10, w: 4, h: 10, vy: -7 });
          lastShot = now;
        }

        // Update bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
          const b = bullets[i];
          b.y += b.vy;
          if (b.y + b.h < 0) bullets.splice(i, 1);
        }

        // Enemy bounds and movement
        let minX = Infinity, maxX = -Infinity;
        for (const e of enemies) if (e.alive) { minX = Math.min(minX, e.x); maxX = Math.max(maxX, e.x); }
        if (minX === Infinity) { // all dead
          running = false;
          return;
        }
        const hitLeft = minX <= 16;
        const hitRight = maxX >= W - 32;
        if ((hitLeft && enemyDir === -1) || (hitRight && enemyDir === 1)) {
          enemyDir *= -1;
          stepDownFrames = 12;
          enemySpeed += 0.06;
        }
        for (const e of enemies) if (e.alive) {
          e.x += enemySpeed * enemyDir;
          if (stepDownFrames > 0) e.y += 1;
        }
        if (stepDownFrames > 0) stepDownFrames--;

        // Collisions: bullets vs enemies
        for (let i = bullets.length - 1; i >= 0; i--) {
          const b = bullets[i];
          for (const e of enemies) {
            if (!e.alive) continue;
            if (b.x < e.x + e.w && b.x + b.w > e.x && b.y < e.y + e.h && b.y + b.h > e.y) {
              e.alive = false;
              bullets.splice(i, 1);
              score += 10;
              break;
            }
          }
        }
      }

      function draw() {
        ctx.clearRect(0, 0, W, H);

        // Star field
        ctx.fillStyle = 'rgba(255,255,255,.08)';
        for (let i = 0; i < 80; i++) {
          const x = (i * 73) % W;
          const y = (i * 131) % H;
          ctx.fillRect(x, y, 1, 1);
        }

        // Player ship
        drawShip(player.x, player.y);

        // Bullets
        ctx.fillStyle = '#e5e7eb';
        for (const b of bullets) ctx.fillRect(b.x, b.y, b.w, b.h);

        // Enemies
        for (const e of enemies) if (e.alive) drawAlien(e.x, e.y);

        // HUD
        ctx.fillStyle = '#9ca3af';
        ctx.font = '14px ui-monospace, SFMono-Regular, Menlo, monospace';
        ctx.fillText(`Score ${score}`, 12, 20);
        if (!running) centerText('Press Start');
        else if (paused) centerText('Paused');
      }

      function centerText(t) {
        ctx.fillStyle = 'rgba(229,231,235,0.92)';
        ctx.font = 'bold 22px ui-sans-serif, system-ui, -apple-system';
        const m = ctx.measureText(t);
        ctx.fillText(t, (W - m.width) / 2, H / 2);
      }

      function drawShip(x, y) {
        ctx.fillStyle = '#34d399';
        ctx.fillRect(x, y, player.w, 6);
        ctx.fillRect(x + 6, y - 6, player.w - 12, 6);
        ctx.fillRect(x + 14, y - 12, player.w - 28, 6);
      }

      function drawAlien(x, y) {
        ctx.fillStyle = '#a7f3d0';
        ctx.fillRect(x, y, 16, 2);
        ctx.fillRect(x - 2, y + 2, 20, 2);
        ctx.fillRect(x, y + 4, 16, 2);
        ctx.fillRect(x + 2, y + 6, 12, 2);
        ctx.fillRect(x + 4, y + 8, 8, 2);
        ctx.fillRect(x + 6, y + 10, 4, 2);
      }

      // Initial paint so canvas is not empty
      (function initial() { draw(); })();
    })();
  </script>

  <!-- SVG Crest Mark -->
  <template id="crest">
    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-label="Tomkins crest">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#d1d5db"/>
          <stop offset="60%" stop-color="#a3a3a3"/>
          <stop offset="100%" stop-color="#6b7280"/>
        </linearGradient>
      </defs>
      <rect x="8" y="8" width="184" height="184" rx="92" fill="url(#g)" opacity=".08"/>
      <!-- Monogram T -->
      <path d="M50 70h100v18h-40v74h-20V88H50z" fill="#cfcfcf"/>
    </svg>
  </template>
  <script>
    // Mount crest into the circular emblem
    const tpl = document.getElementById('crest');
    const emblem = document.createElement('div');
    emblem.className = 'crest';
    emblem.appendChild(tpl.content.cloneNode(true));
    document.querySelector('.row').prepend(emblem);

    // Populate ticker with MLB NL West standings
    const tickerTrack = document.querySelector('.ticker__track');
    const setTickerText = (text) => {
      if (!tickerTrack) return;
      tickerTrack.innerHTML = '';
      for (let i = 0; i < 4; i++) {
        const span = document.createElement('span');
        span.textContent = text;
        tickerTrack.appendChild(span);
      }
    };

    (async () => {
      // Render inline local fallback immediately
      const inline = document.getElementById('nlw-local');
      if (inline) {
        try {
          const d = JSON.parse(inline.textContent || '{}');
          if (d && Array.isArray(d.teams)) {
            const parts = d.teams.map(t => {
              const name = t.abbr || t.name || 'Team';
              const w = t.wins ?? '—';
              const l = t.losses ?? '—';
              const gbVal = typeof t.gamesBack === 'string' ? parseFloat(t.gamesBack) : Number(t.gamesBack);
              const gbText = !Number.isNaN(gbVal) && gbVal > 0 ? ` (${gbVal} GB)` : '';
              return `${name} ${w}-${l}${gbText}`;
            });
            setTickerText(`NL West: ${parts.join(', ')}`);
          }
        } catch {}
      }
      const season = new Date().getFullYear();
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const date = `${yyyy}-${mm}-${dd}`;

      const local = [
        './standings-nl-west.json',
        '/standings-nl-west.json',
        '/tomkins-live/standings-nl-west.json'
      ];
      const base = [
        `https://statsapi.mlb.com/api/v1/standings?leagueId=104&season=${season}&standingsTypes=byDivision&date=${date}`,
        `https://statsapi.mlb.com/api/v1/standings/byDivision?leagueId=104&season=${season}&date=${date}`,
        `https://statsapi.mlb.com/api/v1/standings?leagueId=104&season=${season}&date=${date}`,
        `https://statsapi.mlb.com/api/v1/standings?leagueId=104&season=${season}`
      ];
      const espn = [
        'https://site.api.espn.com/apis/v2/sports/baseball/mlb/standings'
      ];
      const proxies = [
        (u) => `https://r.jina.ai/http/${u.replace(/^https?:\/\//, '')}`,
        (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
        (u) => `https://cors.isomorphic-git.org/${u}`,
        (u) => `https://thingproxy.freeboard.io/fetch/${u}`
      ];
      const endpoints = [
        // Try CORS-safe proxies first for best chance on GitHub Pages
        ...base.map(u => proxies[2](u)), // cors.isomorphic-git.org
        ...base.map(u => proxies[0](u)), // r.jina.ai
        ...base.map(u => proxies[1](u)), // allorigins
        ...base.map(u => proxies[3](u)), // thingproxy
        // Then try direct
        ...base,
        // ESPN as alternative
        ...espn.map(u => proxies[2](u)),
        ...espn.map(u => proxies[0](u)),
        ...espn.map(u => proxies[1](u)),
        ...espn.map(u => proxies[3](u)),
        ...espn,
        // Finally local JSON fallback
        ...local
      ];

      const fetchJson = async (url) => {
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const ct = res.headers.get('content-type') || '';
        if (ct.includes('application/json')) return res.json();
        const text = await res.text();
        try { return JSON.parse(text); } catch { throw new Error('Bad JSON'); }
      };

      const fallbackSnapshot = () => {
        // Last-known-style snapshot as a graceful fallback
        const text = 'NL West: LAD —, SD —, ARI —, SF —, COL —';
        setTickerText(text);
      };

      const tryParseEspn = (data) => {
        // Attempt to extract NL West from ESPN-style JSON
        if (!data) return null;
        const queue = [data];
        const divisions = [];
        while (queue.length) {
          const node = queue.shift();
          if (Array.isArray(node)) { node.forEach(n => queue.push(n)); continue; }
          if (node && typeof node === 'object') {
            if (node.children) queue.push(node.children);
            if (node.groups) queue.push(node.groups);
            if (node.leagues) queue.push(node.leagues);
            if (node.sports) queue.push(node.sports);
            if (node.standings && Array.isArray(node.standings.entries)) {
              divisions.push({ name: (node.name || node.abbreviation || '').toString(), entries: node.standings.entries });
            }
          }
        }
        // Prefer a division named NL West
        let target = divisions.find(d => /nl\s*west|national\s+league\s+west/i.test(d.name));
        if (!target) {
          // fallback: any division named West
          target = divisions.find(d => /west/i.test(d.name));
        }
        if (!target) return null;
        const abbrSet = new Set(['LAD','SD','ARI','SF','COL']);
        const parts = target.entries
          .map(e => {
            const team = e.team || {};
            const abbr = team.abbreviation || team.abbr || team.shortDisplayName || team.displayName;
            const stats = Array.isArray(e.stats) ? e.stats : [];
            const getStat = (key) => {
              const s = stats.find(s => s.name === key || s.abbreviation === key);
              if (!s) return undefined;
              const v = s.value ?? s.displayValue;
              const n = Number(v);
              return Number.isFinite(n) ? n : undefined;
            };
            const wins = getStat('wins') ?? getStat('W');
            const losses = getStat('losses') ?? getStat('L');
            const gb = getStat('gamesBehind') ?? getStat('GB');
            return { abbr, wins, losses, gb };
          })
          .filter(t => abbrSet.has(String(t.abbr).toUpperCase()));
        if (!parts.length) return null;
        parts.sort((a,b) => (b.wins - a.wins) || (a.losses - b.losses));
        const text = 'NL West: ' + parts.map(t => `${String(t.abbr).toUpperCase()} ${t.wins ?? '—'}-${t.losses ?? '—'}${(t.gb ?? 0) > 0 ? ` (${t.gb} GB)` : ''}`).join(', ');
        return text;
      };

      try {
        let data = null;
        for (const url of endpoints) {
          try {
            const d = await fetchJson(url);
            // If local JSON shape
            if (d && Array.isArray(d.teams)) { data = d; break; }
            // If MLB Stats shape
            if (d && Array.isArray(d.records)) { data = d; break; }
            // If ESPN shape yields a parseable NL West text, render immediately
            const espnText = tryParseEspn(d);
            if (espnText) { setTickerText(espnText); return; }
          } catch (_) { /* continue */ }
        }
        // Support our local JSON format or MLB Stats API format
        if (data && Array.isArray(data.teams)) {
          const parts = data.teams.map(t => {
            const name = t.abbr || t.name || 'Team';
            const wRaw = (t.wins ?? t.w ?? '—');
            const lRaw = (t.losses ?? t.l ?? '—');
            const w = (typeof wRaw === 'number' || /^\d+$/.test(String(wRaw))) ? wRaw : '—';
            const l = (typeof lRaw === 'number' || /^\d+$/.test(String(lRaw))) ? lRaw : '—';
            const gbVal = typeof t.gamesBack === 'string' ? parseFloat(t.gamesBack) : Number(t.gamesBack);
            const gbText = !Number.isNaN(gbVal) && gbVal > 0 ? ` (${gbVal} GB)` : '';
            return `${name} ${w}-${l}${gbText}`;
          });
          const text = `NL West: ${parts.join(', ')}`;
          setTickerText(text);
          return;
        }
        if (!data || !Array.isArray(data.records)) { /* leave default */ return; }

        const records = data.records;
        const west = records.find(r => {
          const leagueName = (r && r.league && r.league.name) || '';
          const isNL = (r && r.league && r.league.id === 104) || /national/i.test(leagueName);
          const isWest = r && r.division && /west/i.test(r.division.name || '');
          return isNL && isWest;
        }) || records.find(r => r && r.division && /west/i.test(r.division.name || ''));
        if (!west || !Array.isArray(west.teamRecords)) { /* leave default */ return; }

        const teams = [...west.teamRecords];
        teams.sort((a, b) => (b.wins - a.wins) || (a.losses - b.losses));
        const parts = teams.map(tr => {
          const name = (tr.team && (tr.team.abbreviation || tr.team.name)) || 'Team';
          const w = tr.wins ?? '?';
          const l = tr.losses ?? '?';
          const gbVal = typeof tr.gamesBack === 'string' ? parseFloat(tr.gamesBack) : Number(tr.gamesBack);
          const gbText = !Number.isNaN(gbVal) && gbVal > 0 ? ` (${gbVal} GB)` : '';
          return `${name} ${w}-${l}${gbText}`;
        });
        const text = `NL West: ${parts.join(', ')}`;
        setTickerText(text);
      } catch (e) { /* leave default */ }
    })();
  </script>
</body>
</html>
